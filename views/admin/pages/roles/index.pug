extends ../../layout/defaut.pug

block main
  //- Kiểm tra quyền xem danh sách
  if(role.permissions.includes("roles_view"))
    .container-fluid.mt-4
      .d-flex.justify-content-between.align-items-center.mb-4
        h1.text-primary.fw-bold Danh Sách Nhóm Quyền
        
        //- Kiểm tra quyền thêm mới
        if(role.permissions.includes("roles_add"))
          a.btn.btn-outline-primary(href="/admin/roles/create")
            i.fas.fa-plus.me-2
            | Thêm mới

      .card.shadow-sm.border-0
        .card-body
          if(roles.length > 0)
            table.table.table-hover.align-middle
              thead.table-light
                tr
                  th STT
                  th Nhóm quyền
                  th Mô tả ngắn
                  th Ngày tạo
                  th Hành động
              tbody
                each item, index in roles
                  tr
                    td #{index + 1}
                    td 
                      b.text-dark #{item.title}
                    td 
                      //- Render HTML từ TinyMCE và giới hạn hiển thị để tránh vỡ layout
                      div.small.text-muted !{item.mo_ta}
                    td 
                      span.badge.bg-light.text-dark
                        i.far.fa-calendar-alt.me-1
                        | #{new Date(item.createdAt).toLocaleDateString('vi-VN')}
                    td
                      .d-flex.gap-2
                        //- Nút sửa
                        if(role.permissions.includes("roles_edit"))
                          a.btn.btn-sm.btn-warning(href=`/admin/roles/edit/${item.id}`) 
                            i.fas.fa-edit.me-1
                            | Sửa
                          
                        //- Nút xóa: Sử dụng attribute 'button-delete' để JS bắt sự kiện
                        if(role.permissions.includes("roles_delete"))
                          button.btn.btn-sm.btn-danger(
                            button-delete 
                            data-id=item.id
                          ) 
                            i.fas.fa-trash.me-1
                            | Xóa

                        //- Nút chi tiết
                        if(role.permissions.includes("roles_chitiet"))
                          a.btn.btn-sm.btn-secondary(href=`/admin/roles/detail/${item.id}`) 
                            i.fas.fa-info-circle.me-1
                            | Chi tiết
          else
            .text-center.py-5
              p.text-muted Chưa có nhóm quyền nào được tạo.

    //- -------------------------------------------------------
    //- FORM ẨN ĐỂ XỬ LÝ XÓA (Cực kỳ quan trọng để JS hoạt động)
    //- -------------------------------------------------------
    form(
      id="form-delete-item"
      method="POST"
      action=""
      data-path="/admin/roles/delete"
    )

    //- Form ẩn để xử lý phân quyền (Nếu trang này có nút lưu quyền)
    form(
      id="form-change-permissions"
      method="POST"
      action="/admin/roles/permissions?_method=PATCH"
    )
      input(type="hidden" name="permissions")

  else
    //- Hiển thị nếu không có quyền truy cập
    .container.mt-5
      .alert.alert-danger.text-center
        h4 Bạn không có quyền truy cập trang này!
        a.btn.btn-link(href="/admin/dashboard") Quay lại bảng điều khiển