extends ../../layout/defaut.pug

block main
  .container.my-5
    .row.justify-content-center
      .col-md-8
        .card.shadow-sm.border-0
          .card-header.bg-warning.text-dark.py-3
            h4.mb-0.fw-bold 
              i.fas.fa-user-edit.me-2
              | Chỉnh sửa thông tin cá nhân

          .card-body.p-4
            form(
              action=`/${PefixAdmin}/my-account/edit?_method=PATCH`
              method="POST"
              enctype="multipart/form-data"
            )
              //- Họ và tên
              .mb-3
                label.form-label.fw-bold(for="fullName") Họ tên
                input#fullName.form-control(
                  type="text"
                  name="fullName"
                  value=user.fullName
                  required
                )
              
              .row
                //- Email
                .col-md-6.mb-3
                  label.form-label.fw-bold(for="email") Email
                  input#email.form-control(
                    type="email"
                    name="email"
                    value=user.email
                    required
                  )
                
                //- Số điện thoại
                .col-md-6.mb-3
                  label.form-label.fw-bold(for="phone") Số điện thoại
                  input#phone.form-control(
                    type="text"
                    name="phone"
                    value=user.phone
                  )

              //- Khu vực Upload Avatar
              .mb-3(upload-image)
                label.form-label.fw-bold(for="avatar") Ảnh đại diện
                input#avatar.form-control(
                  type="file"
                  name="avatar"
                  accept="image/*"
                  upload-image-input
                )
                .mt-3.text-center
                  img.img-thumbnail.rounded-circle(
                    src=(user.avatar ? user.avatar : "/img/avatar-default.png")
                    upload-image-preview
                    style="width: 150px; height: 150px; object-fit: cover; border: 2px solid #ddd;"
                  )

              //- Đổi mật khẩu (Optional)
              .p-3.bg-light.rounded.mb-4
                h6.fw-bold.text-danger 
                  i.fas.fa-key.me-2
                  | Thay đổi mật khẩu
                small.text-muted (Để trống nếu không muốn thay đổi)
                input#password.form-control.mt-2(
                  type="password"
                  name="password"
                  placeholder="Nhập mật khẩu mới"
                )

              //- Nút bấm
              .hr.mt-4.mb-3
              .d-flex.justify-content-end
                a.btn.btn-outline-secondary.me-2(href=`/${PefixAdmin}/my-account`) 
                  | Hủy bỏ
                button.btn.btn-primary.px-4(type="submit") 
                  | Lưu thay đổi
  script.
    // Script đơn giản để preview ảnh ngay khi chọn file
    const uploadImage = document.querySelector("[upload-image]");
    if(uploadImage) {
      const uploadImageInput = uploadImage.querySelector("[upload-image-input]");
      const uploadImagePreview = uploadImage.querySelector("[upload-image-preview]");

      uploadImageInput.addEventListener("change", (e) => {
        const file = e.target.files[0];
        if(file) {
          uploadImagePreview.src = URL.createObjectURL(file);
        }
      });
    }